(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{TiA8:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var s=i("XNiG"),n=i("wd/R"),a=i("fXoL"),o=i("5IsW"),c=i("fHQ/"),r=i("H9Rt"),l=i("au7T"),p=i("EnSQ"),h=i("L7Xq"),d=i("Eioz"),_=i("oBZJ"),u=i("4bKs");let y=(()=>{class e{constructor(e,t,i,s,n,a,o,c,r){this.constant=e,this.encryptDecryptService=t,this.localStorageService=i,this.commonMethod=s,this.dataService=n,this.httpService=a,this.translatePipe=o,this.pluginService=c,this.loaderService=r,this.mobileNumber="",this.deviceId="",this.xmlPayloadValue="",this.xmlCallFromDashboard=!1,this.npciFlowIdentifier="",this.npciCredCounter=0,this.entityId="",this.upiMobileNumber="",this.appVersion="",this.clientAppVersion="",this.locale="",this.packageName="",this.type="",this.refUrl="",this.currentLanguage="",this.tokenValue="",this.tokenExpiry="",this.omniApiName="",this.encryptKey="",this.selectedFlow="",this.isFromModifyMandate=!1,this.upiCreateMandateModel={txnId:"",payerVPA:"",payeeVPA:"",txnAmount:"",payeeName:""},this.selectedMandateDetails={txnId:"",payerVPA:"",payeeVPA:"",txnAmount:"",payeeName:""},this.credTypeValue="",this.transactionId=""}initData(){this.mobileNumber=this.localStorageService.getLocalStorage(this.constant.storage_mobileNo),this.upiMobileNumber=this.commonMethod.processPhoneNo(this.mobileNumber),this.deviceId=this.localStorageService.getLocalStorage(this.constant.key_deviceId),this.entityId=this.constant.val_upi_psb,this.appVersion=this.constant.val_upi_app_version,this.clientAppVersion=this.constant.val_clientAppVersion,this.locale=this.dataService.getSelectedLanguageCodeUPI(),this.packageName=this.constant.val_app_pakage_name,this.type="initial",this.refUrl=this.constant.val_upi_refUrl,this.currentLanguage=this.dataService.getSelectedLanguageCodeUPI(),this.token="",this.tokenValue="",this.tokenExpiry="",this.localStorageService.getSessionStorage(this.constant.val_sessionKey)?(this.omniApiName=this.constant.upiserviceName_PROCESSUPISERVICESESSION,this.encryptKey=this.localStorageService.getSessionStorage(this.constant.val_sessionKey)?this.localStorageService.getSessionStorage(this.constant.val_sessionKey):""):(this.omniApiName=this.constant.upiserviceName_PROCESSUPISERVICE,this.encryptKey=this.mobileNumber+this.constant.mapEncryptKey)}androidStartCLLibrary(e,t,i){return this.loaderService.showLoader(),this.npciFlowIdentifier=t,this.accountDetails=e,this.subject=i,this.localStorageService.hasKeyLocalStorage("NpciToken")&&this.localStorageService.hasKeyLocalStorage("NpciTokenExpiry")&&(this.tokenValue=this.localStorageService.getLocalStorage("NpciToken"),this.tokenExpiry=this.localStorageService.getLocalStorage("NpciTokenExpiry")),this.setNpciVariables(this.pluginService.getDeviceUUID(),this.commonMethod.processPhoneNo(this.mobileNumber),this.packageName,this.refUrl,this.currentLanguage,this.entityId,this.tokenValue,this.tokenExpiry),this.startCLService(this.type),this.subject.asObservable()}setNpciVariables(e,t,i,s,n,a,o,c){console.log("calling setNpciVariables..."),cordova.plugins.npciAndroidPlugin.setNPCIVariables({deviceId:e,mobileNo:t,id:i,url:s,locale:n,entity:a,tokenValue:o,expiry:c,algo:"AES",padding:"AES/CBC/PKCS5Padding"},e=>{console.log("setNPCIVariables Success => ",e)},e=>{this.loaderService.hideLoader(),console.log("setNPCIVariables Error => ",e)})}startCLService(e){console.log("calling startCLService..."),this.dataService.isCredCallbackSuccess=!1,cordova.plugins.npciAndroidPlugin.startCLService(e,this.npciCLInitCallback.bind(this),e=>{console.log("startCLService Error => ",e),this.loaderService.hideLoader()})}npciCLInitCallback(e){console.log("npciCLInitCallback data => ",e);try{let t=JSON.parse(e);console.log(t),"00"==t.status?1==t.registered?this.dataService.isEmpty(this.xmlPayloadValue)?(this.xmlCallFromDashboard=!1,this.getXMLPayloadService()):this.npciContinueExecutionPostXML():""===t.challenge?(this.loaderService.hideLoader(),showToastMessage(this.translatePipe.transform("error_something_went_wrong1"),"error"),console.log("error_something_went_wrong1")):this.getTokenServices(t.challenge,t.tokenType):(this.loaderService.hideLoader(),showToastMessage(this.translatePipe.transform("error_something_went_wrong2"),"error"),console.log("error_something_went_wrong2"))}catch(t){this.loaderService.hideLoader(),showToastMessage(this.translatePipe.transform("error_something_went_wrong3"),"error"),console.log("error_something_went_wrong3",t)}}getXMLPayloadService(){console.log("calling getXMLPayloadService...");try{let e={[this.constant.key_upi_entityID]:this.constant.val_upi_psb,[this.constant.key_npci_mobileNo]:this.commonMethod.processPhoneNo(this.mobileNumber),[this.constant.key_npci_subAction]:this.constant.upiserviceName_GetListKeysString,[this.constant.key_npci_inputParam]:{[this.constant.key_npci_appVersion]:this.constant.val_upi_app_version,[this.constant.key_npci_language]:this.currentLanguage,[this.constant.key_upi_entityID]:this.constant.val_upi_psb,[this.constant.key_upi_device]:this.dataService.getDeviceObjectForUpi()}},t={[this.constant.key_npci_entityId]:this.constant.getEntityId(this.constant.val_entityId_UMOB),[this.constant.key_npci_cbsType]:this.constant.val_cbsTypeTcs,[this.constant.key_npci_mobPlatform]:this.constant.val_mobPlatform,[this.constant.key_npci_mobileAppVersion]:this.constant.val_mobileAppVersion,[this.constant.key_npci_deviceId]:this.localStorageService.getLocalStorage(this.constant.storage_deviceId),[this.constant.key_npci_clientAppVersion]:this.constant.val_clientAppVersion,[this.constant.key_npci_upiRequest]:JSON.stringify(e)},i=this.encryptDecryptService.encryptText(this.encryptKey,JSON.stringify(t));console.log("encryptData => ",JSON.stringify(i)),this.httpService.callBankingAPIService(i,this.localStorageService.getLocalStorage(this.constant.storage_deviceId),this.omniApiName,!0).subscribe(e=>{console.log("Omni Api Success => ",e);let t=e.responseParameter;"00"==t.opstatus&&"00"==t.upiResponse.status?(console.log("xmlPayloadServiceApiCall success",e),console.log(e.responseParameter),this.xmlPayloadValue=t.upiResponse.responseParameter.RESULT,this.npciContinueExecutionPostXML()):(console.log("xmlPayloadServiceApiCall Error",e),this.subject.unsubscribe())},e=>{this.loaderService.hideLoader(),console.log("Omni API error => ",e)})}catch(e){this.loaderService.hideLoader(),showToastMessage(this.translatePipe.transform("error_something_went_wrong4"),"error"),console.log("error_something_went_wrong4",e)}}npciContinueExecutionPostXML(){console.log("calling npciContinueExecutionPostXML..."),this.dataService.npciFinalCredResponseModel={},this.finalCredResponseModel={},this.loaderService.hideLoader(),this.npciFlowIdentifier==this.constant.val_npci_flow_setUpiPin_android?this.continueSetUpiPin(this.accountDetails):this.npciFlowIdentifier==this.constant.val_npci_flow_balanceEnquiry_android?this.continueCheckAvailableBalance(this.accountDetails):this.npciFlowIdentifier==this.constant.val_npci_flow_sendMoney_android||this.npciFlowIdentifier==this.constant.val_npci_flow_acceptMandate_android?this.continueUpiSendMoney(this.accountDetails):this.npciFlowIdentifier==this.constant.val_npci_flow_changeUpiPin_android?this.continueChangeUpiPin(this.accountDetails):this.npciFlowIdentifier==this.constant.val_npci_flow_createMandate_android||this.npciFlowIdentifier==this.constant.val_npci_flow_updateMandateEnquiry_android?this.continueCreateMandate(this.accountDetails):this.npciFlowIdentifier==this.constant.val_npci_flow_mandateBalanceEnquiry_android?this.getUPIMandateAccountBalance(this.accountDetails):this.npciFlowIdentifier==this.constant.val_npci_flow_revokeMandate_android||this.npciFlowIdentifier==this.constant.val_npci_flow_executeMandate_android||this.npciFlowIdentifier==this.constant.val_npci_flow_pauseUnpauseMandate_android?this.continueRevokeMandate(this.accountDetails):this.npciFlowIdentifier==this.constant.val_npci_flow_acceptPendingRequest?this.continueCollectAcceptRequest(this.accountDetails):this.npciFlowIdentifier==this.constant.val_npci_flow_modifyMandate_android?this.continueCreateMandate(this.accountDetails):this.npciFlowIdentifier==this.constant.val_npci_flow_pauseUnpauseMandate_android?this.initiateSendMoney(this.transactionId,this.selectedMandateDetails.payerVPA,this.selectedMandateDetails.payeeVPA,this.dataService.roundOffAmount(this.selectedMandateDetails.txnAmount),this.selectedMandateDetails.payeeName):console.log("Else npciFlowIdentifier => ",this.npciFlowIdentifier)}getTokenServices(e,t){try{this.getTransactionId().subscribe(i=>{let s=i;console.log("GetToken Transaction ID ",s);let a=this.localStorageService.getLocalStorage(this.constant.key_deviceId);this.dataService.isEmpty(t)&&(t="initial");let o=this.pluginService.getDeviceUUID()+"|"+this.constant.val_app_pakage_name+"|"+this.commonMethod.processPhoneNo(this.mobileNumber)+"|"+e;console.log("getToken values"+s+o);let c={[this.constant.key_upi_entityID]:this.constant.val_upi_psb,[this.constant.key_npci_mobileNo]:this.commonMethod.processPhoneNo(this.mobileNumber),[this.constant.key_npci_subAction]:this.constant.upiserviceName_GetToken,[this.constant.key_npci_inputParam]:{[this.constant.key_npci_appVersion]:this.constant.val_upi_app_version,[this.constant.key_upi_credType]:this.constant.val_upi_credTypeChallenge,[this.constant.key_npci_txnNote]:this.constant.val_upi_txnNote,[this.constant.key_npci_credSubType]:this.constant.val_upi_initial,[this.constant.key_upi_entityID]:this.constant.val_upi_psb,[this.constant.key_upi_refID]:s,[this.constant.key_upi_refUrl]:this.constant.val_upi_refUrl,[this.constant.key_npci_keyType]:this.constant.val_upi_GET_TOKEN,[this.constant.key_npci_language]:this.currentLanguage,[this.constant.key_npci_credData]:o,[this.constant.key_npci_device]:this.dataService.getDeviceObjectForUpi(),[this.constant.key_upi_txnID]:s}},r={[this.constant.key_npci_entityId]:this.constant.getEntityId(this.constant.val_entityId_UMOB),[this.constant.key_npci_cbsType]:this.constant.val_cbsTypeTcs,[this.constant.key_npci_mobPlatform]:this.constant.val_mobPlatform,[this.constant.key_npci_mobileAppVersion]:this.constant.val_mobileAppVersion,[this.constant.key_npci_deviceId]:a,[this.constant.key_npci_clientAppVersion]:this.constant.val_clientAppVersion,[this.constant.key_npci_upiRequest]:JSON.stringify(c)};console.log("Token Json"+c),console.log("omniReqJson ",JSON.stringify(r));let l=this.encryptDecryptService.encryptText(this.encryptKey,JSON.stringify(r));console.log("encryptDatagetOmniRequestObject => ",JSON.stringify(l)),this.httpService.callBankingAPIService(l,this.localStorageService.getLocalStorage(this.constant.storage_deviceId),this.omniApiName,!0).subscribe(e=>{console.log("Omni API Success",e);let t=e.responseParameter;"00"==t.opstatus&&"00"==t.upiResponse.status?(console.log("Token API Success =>",t),this.tokenValue=t.upiResponse.responseParameter.RESULT,this.tokenExpiry=n().add(90,"days").format("DD/MM/YYYY"),this.localStorageService.setLocalStorage("NpciToken",this.tokenValue),this.localStorageService.setLocalStorage("NpciTokenExpiry",this.tokenExpiry),console.log("TOKEN VALUES => "),console.log(this.tokenValue),console.log(this.tokenExpiry),this.getTransactionId().subscribe(e=>{this.transactionId=e,console.log("Inside geToken Transaction ID ",e),this.androidStartCLLibrary(this.accountDetails,this.npciFlowIdentifier,this.subject)})):(console.log("Token API Error =>",t),this.subject.unsubscribe())},e=>{this.loaderService.hideLoader(),console.log("Omni API Error =>",e)})})}catch(i){this.loaderService.hideLoader(),showToastMessage(this.translatePipe.transform("error_something_went_wrong5"),"error"),console.log("error_something_went_wrong5",i)}}getTransactionId(){let e=new s.a;return cordova.plugins.npciAndroidPlugin.generateTransactionId("PSB",t=>{console.log("getTransactionId Success => ",t),e.next(t),e.complete()},t=>{console.log("getTransactionId Error => ",t),e.next(t),e.complete()}),e.asObservable()}setOtpCredValues(e,t,i,s,n){console.log("calling setOtpCredValues..."),cordova.plugins.npciAndroidPlugin.setOtpCredValues({credType:e,credSubType:t,credDType:i,credDLength:s,accountDetails:n},e=>{console.log("setOtpCredValues Success => ",e),this.setBankNameCredXml(n.bankName,this.credTypeValue,n.credType,n.credSubType,n.credDType,n.credDLength,n.atmCredType,n.atmCredSubType,n.atmDType,n.atmDLength,this.xmlPayloadValue,!0,n)},e=>{this.loaderService.hideLoader(),console.log("setOtpCredValues Error => ",e)})}setBankNameCredXml(e,t,i,s,n,a,o,c,r,l,p,h,d,_){console.log("accountDetails",d),console.log("considerOtp",h),console.log("xmlPayload",p),console.log("atmCredDLength",l),console.log("atmCredDType",r),console.log("atmCredSubType",c),console.log("atmCredType",o),console.log("credDLength",a),console.log("credDType",n),console.log("credSubType",s),console.log("credType",i),console.log("credTypeValue",t),console.log("bankName",e),console.log("calling setBankNameCredXml...");let u={bankName:e,credTypeValue:t,credType:i,credSubType:s,credDType:n,credDLength:a,atmCredType:o||"",atmCredSubType:c||"",atmCredDType:r||"",atmCredDLength:l||"",xmlPayload:p,considerOtp:h};console.log("paramObj => ",u),cordova.plugins.npciAndroidPlugin.setBankNameCredXML(u,e=>{console.log("setBankNameCredXML Success => ",e),this.loaderService.hideLoader();let t,i=d.paymentAddress,s=this.transactionId;this.upiPayModelObj=this.dataService.upiPayModelObj,this.npciFlowIdentifier==this.constant.val_npci_flow_setUpiPin_android?(console.log("1 => accountDetails",d),this.initiateSetUpiPin(i,s,d.accNum)):this.npciFlowIdentifier==this.constant.val_npci_flow_balanceEnquiry_android||this.npciFlowIdentifier==this.constant.val_npci_flow_globalUpi_android?this.initiateBalanceEnquiry(s,i,d.accNum):this.npciFlowIdentifier==this.constant.val_npci_flow_sendMoney_android||this.npciFlowIdentifier==this.constant.val_npci_flow_acceptMandate_android?this.selectedFlow===this.constant.val_npci_upiPayVpa||this.selectedFlow===this.constant.val_npci_upiPayVpaBqr||this.selectedFlow===this.constant.val_npci_approveMandate?null!==this.upiPayModelObj?this.initiateSendMoney(s,this.upiPayModelObj.payerAddr,this.upiPayModelObj.payeeAddr,this.upiPayModelObj.txnAmount,this.upiPayModelObj.payeeName):showToastMessage(this.translatePipe.transform("error_something_went_wrong6"),"error"):this.selectedFlow===this.constant.val_npci_upiPayMmid?null!==this.upiPayModelObj?this.initiateSendMoney(s,this.upiPayModelObj.payerAddr,this.upiPayModelObj.payeeAddr,this.upiPayModelObj.txnAmount,this.upiPayModelObj.payeeName):showToastMessage(this.translatePipe.transform("error_something_went_wrong7"),"error"):this.selectedFlow===this.constant.val_npci_upiPayIfsc||this.selectedFlow===this.constant.val_npci_upiPayIfscBqr?null!==this.upiPayModelObj?this.initiateSendMoney(s,this.upiPayModelObj.payerAddr,this.upiPayModelObj.payeeAddr,this.upiPayModelObj.txnAmount,this.upiPayModelObj.payeeName):showToastMessage(this.translatePipe.transform("error_something_went_wrong8"),"error"):this.selectedFlow===this.constant.val_npci_pendingRequest?null!==this.upiPayModelObj?(t=this.dataService.isEmpty(this.upiPayModelObj.acceptedAmount)?this.upiPayModelObj.txnAmount:this.upiPayModelObj.acceptedAmount,this.initiateSendMoney(s,this.upiPayModelObj.payerAddr,this.upiPayModelObj.payeeAddr,t,this.upiPayModelObj.payeeName)):showToastMessage(this.translatePipe.transform("error_something_went_wrong9"),"error"):this.selectedFlow===this.constant.val_npci_scanQrPay?null!==this.upiPayModelObj?this.initiateSendMoney(s,this.upiPayModelObj.payerAddr,this.upiPayModelObj.payeeAccount+"@"+this.upiPayModelObj.payeeIfsc+".ifsc.npci",this.upiPayModelObj.txnAmount,this.upiPayModelObj.payeeName):showToastMessage(this.translatePipe.transform("error_something_went_wrong8"),"error"):console.log("Selected Flow = ",this.selectedFlow):this.npciFlowIdentifier==this.constant.val_npci_flow_changeUpiPin_android?this.initiateChangeUpiPin(s,i,d.accNum):this.npciFlowIdentifier==this.constant.val_npci_flow_createMandate_android?this.initiateSendMoney(this.upiCreateMandateModel.txnId,this.upiCreateMandateModel.payerVPA,this.upiCreateMandateModel.payeeVPA,this.upiCreateMandateModel.txnAmount,this.upiCreateMandateModel.payeeName):this.npciFlowIdentifier==this.constant.val_npci_flow_modifyMandate_android?this.initiateSendMoney(this.transactionId,this.upiCreateMandateModel.payerVPA,this.upiCreateMandateModel.payeeVPA,this.upiCreateMandateModel.txnAmount,this.upiCreateMandateModel.payeeName):this.npciFlowIdentifier==this.constant.val_npci_flow_revokeMandate_android||this.npciFlowIdentifier==this.constant.val_npci_flow_pauseUnpauseMandate_android?this.initiateSendMoney(this.transactionId,this.selectedMandateDetails.payerVPA,this.selectedMandateDetails.payeeVPA,this.dataService.roundOffAmount(this.selectedMandateDetails.txnAmount),this.selectedMandateDetails.payeeName):this.npciFlowIdentifier==this.constant.val_npci_flow_acceptPendingRequest?this.initiateCollectRequestAccept(this.dataService.pendingWithMe.txnId,this.dataService.pendingWithMe.payerAddress,this.dataService.pendingWithMe.payeeAddress,this.dataService.pendingWithMe.amount):console.log("Else this.npciFlowIdentifier = ",this.npciFlowIdentifier)},e=>{console.log("setBankNameCredXML Error =>",e)})}initiateSetUpiPin(e,t,i){let s={paymentAddress:e,txnId:t,accountNo:i};console.log("paramObj",s),cordova.plugins.npciAndroidPlugin.initiateSetUpiPin(s,this.finalCredCallback.bind(this),e=>{console.log("initiateSetUpiPin Error => ",e)})}initiateBalanceEnquiry(e,t,i){let s={txnId:e,paymentAddress:t,accountNo:i};console.log("initiateBalanceEnquiry paramObj => ",s),cordova.plugins.npciAndroidPlugin.initiateBalanceEnquiry(s,this.finalCredCallback.bind(this),e=>{console.log("initiateBalanceEnquiry Error => ",e)})}initiateChangeUpiPin(e,t,i){cordova.plugins.npciAndroidPlugin.initiateChangeUpiPin({txnId:e,paymentAddress:t,accountNo:i},this.finalCredCallback.bind(this),e=>{console.log("initiateChangeUpiPin Success => ",e)},e=>{console.log("initiateChangeUpiPin Error => ",e)})}initiateCollectRequestAccept(e,t,i,s){cordova.plugins.npciAndroidPlugin.initiateCollectRequestAccept({txnId:e,transAmount:s,payerAddress:t,payeeAddress:i},this.finalCredCallback.bind(this),e=>{console.log("initiateCollectRequestAccept Error => ",e)})}initiateSendMoney(e,t,i,s,n){cordova.plugins.npciAndroidPlugin.initiateSendMoney({txnId:e,payerAddress:t,payeeAddress:i,amount:s,payeeName:n},this.finalCredCallback.bind(this),e=>{console.log("initiateSendMoney Success => ",e)},e=>{console.log("initiateSendMoney Error => ",e)})}continueSetUpiPin(e){console.log("continueSetUpiPin called..."),this.npciCredCounter=3,(this.dataService.isEmpty(e.atmCredType)||this.dataService.isEmpty(e.atmCredSubType)||this.dataService.isEmpty(e.atmCredDType)||this.dataService.isEmpty(e.atmCredDLength)||"ATMPIN"!=e.atmCredSubType)&&(this.npciCredCounter=2),this.dataService.isEmpty(e.otpCredType)||this.dataService.isEmpty(e.otpCredSubType)||this.dataService.isEmpty(e.otpCredDType)||this.dataService.isEmpty(e.otpCredDLength)?(console.log("1 => OTP Data Empty => setOtpCredValues"),this.setOtpCredValues("OTP","SMS","NUM","6",e)):(console.log("2 => OTP Data not Empty => setOtpCredValues"),this.setOtpCredValues(e.otpCredType,e.otpCredSubType,e.otpCredDType,e.otpCredDLength,e))}continueCheckAvailableBalance(e){console.log("continueCheckAvailableBalance called...");let t=this.constant.val_npci_credTypeUpiPin;this.npciCredCounter=1,this.setBankNameCredXml(e.bankName,t,e.credType,e.credSubType,e.credDType,e.credDLength,e.atmCredType,e.atmCredSubType,e.atmCredDType,e.atmCredDLength,this.xmlPayloadValue,!1,e)}continueUpiSendMoney(e){console.log("continueUpiSendMoney called...");let t=this.constant.val_npci_credTypeUpiPin;this.npciCredCounter=1,this.setBankNameCredXml(e.bankName,t,e.credType,e.credSubType,e.credDType,e.credDLength,e.atmCredType,e.atmCredSubType,e.atmCredDType,e.atmCredDLength,this.xmlPayloadValue,!1,e)}continueChangeUpiPin(e){console.log("continueChangeUpiPin called...");let t=this.constant.val_npci_credTypeChangeUpiPin;this.npciCredCounter=2,this.setBankNameCredXml(e.bankName,t,e.credType,e.credSubType,e.credDType,e.credDLength,e.atmCredType,e.atmCredSubType,e.atmCredDType,e.atmCredDLength,this.xmlPayloadValue,!0,e)}continueCreateMandate(e){console.log("continueCreateMandate called...");let t=this.constant.val_npci_credTypeUpiPin;this.npciCredCounter=1,this.isFromModifyMandate||(this.upiCreateMandateModel.txnId=this.transactionId,console.log("continueCreateMandate Transaction ID ",this.transactionId)),this.setBankNameCredXml(e.bankName,t,e.credType,e.credSubType,e.credDType,e.credDLength,e.atmCredType,e.atmCredSubType,e.atmCredDType,e.atmCredDLength,this.xmlPayloadValue,!1,e)}getUPIMandateAccountBalance(e){console.log("getUPIMandateAccountBalance called...");try{var t={[this.constant.key_npci_action]:this.constant.upiserviceName_UPIBalanceCheck,[this.constant.key_npci_subAction]:this.constant.upiserviceName_UPIBalanceCheck,[this.constant.key_npci_entityId]:this.entityId,[this.constant.key_npci_inputParam]:{[this.constant.key_npci_accNum]:e.accountNo,[this.constant.key_npci_addressType]:"ACCOUNT",[this.constant.key_npci_credKi]:this.finalCredResponseModel.credkey,[this.constant.key_npci_entityId]:this.entityId,[this.constant.key_npci_mobileNo]:this.mobileNumber,[this.constant.key_npci_credData]:this.finalCredResponseModel.credDataForJson,[this.constant.key_npci_credCode]:this.finalCredResponseModel.credId,[this.constant.key_npci_credType]:this.finalCredResponseModel.credType,[this.constant.key_npci_payerAddr]:"apptest123@psb",[this.constant.key_npci_txnNote]:"Set OTP Pin",[this.constant.key_npci_credSubType]:this.finalCredResponseModel.credSubType,[this.constant.key_npci_payerName]:this.dataService.userDetails.FirstName+" "+this.dataService.userDetails.LastName,[this.constant.key_npci_refUrl]:this.refUrl,[this.constant.key_npci_refId]:this.finalCredResponseModel.transactionId,[this.constant.key_npci_ifsc]:e.ifsc,[this.constant.key_npci_accountType]:e.accountType,[this.constant.key_npci_txnId]:this.finalCredResponseModel.transactionId,[this.constant.key_npci_language]:this.currentLanguage,[this.constant.key_npci_amount]:e.acceptedAmount,[this.constant.key_npci_device]:{[this.constant.key_npci_mobileNo]:this.mobileNumber,[this.constant.key_npci_longitude]:this.dataService.longitude,[this.constant.key_npci_latitude]:this.dataService.latitude,[this.constant.key_npci_location]:this.dataService.userLocation,[this.constant.key_npci_deviceId]:this.deviceId,[this.constant.key_npci_deviceIp]:this.dataService.ipAddress,[this.constant.key_npci_deviceOs]:this.dataService.platform+" "+this.dataService.osversion,[this.constant.key_npci_app]:this.constant.val_app_pakage_name,[this.constant.key_npci_capability]:this.constant.val_upi_capability,[this.constant.key_npci_imei1]:this.dataService.imei,[this.constant.key_npci_imei2]:this.dataService.imei,[this.constant.key_npci_operatorId]:this.dataService.selectedSim.carrierName,[this.constant.key_npci_simSerialNo]:this.dataService.selectedSim.simSerialNumber,[this.constant.key_npci_telecom]:this.dataService.selectedSim.carrierName,[this.constant.key_npci_ipv4]:this.dataService.ipAddress,[this.constant.key_npci_ipv6]:this.dataService.ipAddress,[this.constant.key_npci_uuid]:this.dataService.uuid},[this.constant.key_npci_currency]:this.constant.val_npci_inr}};console.log("BalanceEnquiryService",t);let i=this.encryptDecryptService.encryptText(this.encryptKey,JSON.stringify(t));console.log("encryptData => ",JSON.stringify(i)),this.httpService.callBankingAPIService(i,this.localStorageService.getLocalStorage(this.constant.storage_deviceId),this.omniApiName,!0).subscribe(e=>{console.log("Omni Api Success => ",e);let t=e.responseParameter;"00"==t.opstatus&&"00"==t.upiResponse.status?console.log("UPIBalanceCheck success => ",e):(console.log("UPIBalanceCheck Error => ",e),showToastMessage(this.translatePipe.transform("error_something_went_wrong12"),"error"))},e=>{console.log("Omni API error => ",e),showToastMessage(this.translatePipe.transform("error_something_went_wrong13"),"error")})}catch(i){console.log("Exception in getAccountBalanceEnquiry ===>"+i)}}continueRevokeMandate(e){console.log("continueRevokeMandate called...");let t=this.constant.val_npci_credTypeUpiPin;this.npciCredCounter=1,this.setBankNameCredXml(e.bankName,t,e.credType,e.credSubType,e.credDType,e.credDLength,e.atmCredType,e.atmCredSubType,e.atmCredDType,e.atmCredDLength,this.xmlPayloadValue,!1,e)}continueCollectAcceptRequest(e){console.log("continueCollectAcceptRequest called...");let t=this.constant.val_npci_credTypeUpiPin;this.npciCredCounter=1,this.setBankNameCredXml(e.bankName,t,e.credType,e.credSubType,e.credDType,e.credDLength,e.atmCredType,e.atmCredSubType,e.atmCredDType,e.atmCredDLength,this.xmlPayloadValue,!1,e)}finalCredCallback(e){console.log("finalCredCallback param =>",e);let t=e;if("00"==t.status){this.finalCredResponseModel.transactionId=t.transactionId,this.finalCredResponseModel.status=e.status;for(let e=0;e<t.responseArray.length;e++)"ATMPIN"==t.responseArray[e].credSubType?(this.finalCredResponseModel.credATMDataForJson=t.responseArray[e].credDataForJson,this.finalCredResponseModel.credATMkey=t.responseArray[e].credkey,this.finalCredResponseModel.credATMId=t.responseArray[e].credId,this.finalCredResponseModel.credATMType=t.responseArray[e].credType,this.finalCredResponseModel.credATMSubType=t.responseArray[e].credSubType,this.npciCredCounter--):"MPIN"==t.responseArray[e].credSubType?(this.finalCredResponseModel.credDataForJson=t.responseArray[e].credDataForJson,this.finalCredResponseModel.credkey=t.responseArray[e].credkey,this.finalCredResponseModel.credId=t.responseArray[e].credId,this.finalCredResponseModel.credType=t.responseArray[e].credType,this.finalCredResponseModel.credSubType=t.responseArray[e].credSubType,this.npciCredCounter--):(this.finalCredResponseModel.credOTPDataForJson=t.responseArray[e].credDataForJson,this.finalCredResponseModel.credOTPkey=t.responseArray[e].credkey,this.finalCredResponseModel.credOTPId=t.responseArray[e].credId,this.finalCredResponseModel.credOTPType=t.responseArray[e].credType,this.finalCredResponseModel.credOTPSubType=t.responseArray[e].credSubType,this.npciCredCounter--);console.log("this.finalCredResponseModel =",this.finalCredResponseModel),console.log("this.npciCredCounter",this.npciCredCounter)}this.loaderService.hideLoader(),this.subject.next(this.finalCredResponseModel),this.subject.complete()}}return e.\u0275fac=function(t){return new(t||e)(a.ic(o.a),a.ic(c.a),a.ic(r.a),a.ic(l.a),a.ic(p.a),a.ic(h.a),a.ic(d.a),a.ic(_.a),a.ic(u.a))},e.\u0275prov=a.Ub({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},Ygbc:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var s=i("XNiG"),n=i("wd/R"),a=i("fXoL"),o=i("5IsW"),c=i("H9Rt"),r=i("Eioz"),l=i("EnSQ"),p=i("fHQ/"),h=i("L7Xq"),d=i("4bKs"),_=i("au7T");let u=(()=>{class e{constructor(e,t,i,s,n,a,o,c){this.constant=e,this.localStorageService=t,this.translatePipe=i,this.dataService=s,this.encryptDecryptService=n,this.httpService=a,this.loader=o,this.commonMethod=c,this.mobileNumber="",this.deviceId="",this.xmlPayloadValue="",this.npciFlowIdentifier="",this.npciCredCounter=0,this.entityId="",this.upiMobileNumber="",this.appVersion="",this.clientAppVersion="",this.locale="",this.appId="",this.type="",this.refUrl="",this.currentLanguage="",this.tokenValue="",this.tokenExpiry="",this.isNPCIPageRequested=!1,this.selectedMandateDetails={},this.upiCreateMandateModel={},this.omniApiName="",this.encryptKey="",this.selectedFlow="",this.isFromModifyMandate=!1,this.credTypeValue="",this.txnId="",this.expiry="",this.platform="",this.isAtmPINRequired=""}initData(){console.log("NPCI iOS service => Initialising Data"),this.mobileNumber=this.localStorageService.getLocalStorage(this.constant.storage_mobileNo),this.upiMobileNumber=this.commonMethod.processPhoneNo(this.mobileNumber),this.deviceId=this.localStorageService.getLocalStorage(this.constant.key_deviceId),this.upiDeviceId=this.dataService.uuid,this.entityId=this.constant.val_upi_psb,this.appVersion=this.constant.val_upi_app_version,this.clientAppVersion=this.constant.val_clientAppVersion,this.locale=this.dataService.getSelectedLanguageCodeUPI(),this.appId=this.constant.val_app_pakage_name,this.type="initial",this.refUrl=this.constant.val_upi_refUrl,this.currentLanguage=this.dataService.getSelectedLanguageCodeUPI(),this.token="",this.tokenValue="",this.tokenExpiry="",this.platform=this.dataService.platform,this.localStorageService.getSessionStorage(this.constant.val_sessionKey)?(this.omniApiName=this.constant.upiserviceName_PROCESSUPISERVICESESSION,this.encryptKey=this.localStorageService.getSessionStorage(this.constant.val_sessionKey)?this.localStorageService.getSessionStorage(this.constant.val_sessionKey):""):(this.omniApiName=this.constant.upiserviceName_PROCESSUPISERVICE,this.encryptKey=this.mobileNumber+this.constant.mapEncryptKey)}iosStartCLLibrary(e,t,i){return console.log("iosStartCLLibrary called..."),this.subject=i,t==this.constant.val_npci_flow_setUpiPin?this.npciFlowIdentifier=this.constant.val_npci_flow_setUpiPin_ios:t==this.constant.val_npci_flow_balanceEnquiry?this.npciFlowIdentifier=this.constant.val_npci_flow_balanceEnquiry_ios:t==this.constant.val_npci_flow_changeUpiPin?this.npciFlowIdentifier=this.constant.val_npci_flow_changeUpiPin_ios:t==this.constant.val_npci_flow_sendMoney?this.npciFlowIdentifier=this.constant.val_npci_flow_sendMoney_ios:t==this.constant.val_npci_flow_acceptMandate?this.npciFlowIdentifier=this.constant.val_npci_flow_acceptMandate_ios:t==this.constant.val_npci_flow_createMandate?this.npciFlowIdentifier=this.constant.val_npci_flow_createMandate_ios:t==this.constant.val_npci_flow_updateMandateEnquiry?this.npciFlowIdentifier=this.constant.val_npci_flow_updateMandateEnquiry_ios:t==this.constant.val_npci_flow_mandateBalanceEnquiry?this.npciFlowIdentifier=this.constant.val_npci_flow_mandateBalanceEnquiry_ios:t==this.constant.val_npci_flow_revokeMandate?this.npciFlowIdentifier=this.constant.val_npci_flow_revokeMandate_ios:t==this.constant.val_npci_flow_executeMandate?this.npciFlowIdentifier=this.constant.val_npci_flow_executeMandate_ios:t==this.constant.val_npci_flow_acceptPendingRequest?this.npciFlowIdentifier=this.constant.val_npci_flow_acceptPendingRequest_ios:t==this.constant.val_npci_flow_globalUpi?this.npciFlowIdentifier=this.constant.val_npci_flow_globalUpi_ios:t==this.constant.val_npci_flow_debitBlock?this.npciFlowIdentifier=this.constant.val_npci_flow_debitBlock_ios:t==this.constant.val_npci_flow_pauseUnpauseMandate?this.npciFlowIdentifier=this.constant.val_npci_flow_pauseUnpauseMandate_ios:console.log("Unknown Flow Identifier..."),console.log("this.npciFlowIdentifier",this.npciFlowIdentifier),this.accountDetails=e,console.log("accountDetails",e),this.localStorageService.hasKeyLocalStorage("NpciToken")&&this.localStorageService.hasKeyLocalStorage("NpciTokenExpiry")&&(this.tokenValue=this.localStorageService.getLocalStorage("NpciToken"),this.tokenExpiry=this.localStorageService.getLocalStorage("NpciTokenExpiry")),this.setDataNpci(this.upiMobileNumber,this.appId,this.upiDeviceId,this.type,this.entityId,this.refUrl,this.tokenValue,this.tokenExpiry),this.subject.asObservable()}getTransactionId(){console.log("getTransactionId called...");let e=new s.a;return cordova.plugins.npciIosPlugin.getTransactionId({txnIdIdent:"PSB"},t=>{console.log("getTransactionId Success = ",t),e.next(t),e.complete()},t=>{console.log("getTransactionId Error = ",t),e.next(t),e.complete()}),e.asObservable()}setDataNpci(e,t,i,s,n,a,o,c){console.log("setDataNpci called..."),cordova.plugins.npciIosPlugin.setDataNpci({devId:i,moNo:e,id:t,url:a,entity:n,tokenValue:o,expiry:c},e=>{console.log("setDataNpci Success => ",e);let s=this.initializeCommonLib();console.log("returnedValue",s),s?(console.log("Registration already done"),this.registerIosAppNpci()):(console.log("registration Initiated"),this.generateChallenge(i,t))},e=>{console.log("setDataNpci Error => ",e)})}setDataNpciWithoutCallback(e,t,i,s,n,a,o,c){console.log("setDataNpci called..."),cordova.plugins.npciIosPlugin.setDataNpci({devId:i,moNo:e,id:t,url:a,entity:n,tokenValue:o,expiry:c},e=>{console.log("setDataNpci Success => ",e)},e=>{console.log("setDataNpci Error => ",e)})}initializeCommonLib(){if(console.log("initializeCommonLib called..."),!window.hasOwnProperty("cordova"))return!1;cordova.plugins.npciIosPlugin.initializeCommonLib(e=>(console.log("initializeCommonLib Success => ",e),e),e=>(console.log("initializeCommonLib Error => ",e),!1))}generateChallenge(e,t){console.log("generateChallenge called..."),cordova.plugins.npciIosPlugin.generateChallenge({deviceId:e,appId:t},e=>{console.log("generateChallenge Success => ",e),this.getTokenServices(e,"")},e=>{console.log("generateChallenge Error => ",e)})}registerIosAppNpci(){console.log("Start registration..."),this.setDataNpciWithoutCallback(this.upiMobileNumber,this.appId,this.upiDeviceId,"Initial",this.entityId,this.refUrl,this.tokenValue,this.tokenExpiry),this.isAppRegisteredForNpci(this.upiMobileNumber,this.appId,this.upiDeviceId,this.tokenValue,this.tokenExpiry)}isAppRegisteredForNpci(e,t,i,s,n){console.log("isAppRegisteredForNpci called..."),cordova.plugins.npciIosPlugin.isAppRegisteredForNpci({mobileNumber:e,appId:t,deviceId:i,tokenValue:s,tokenExpiry:n},e=>{console.log("isAppRegisteredForNpci Success => ",e),console.log("this.xmlPayloadValue => ",this.xmlPayloadValue),console.log(typeof this.xmlPayloadValue),this.dataService.isEmpty(this.xmlPayloadValue)?(console.log("XML Payload Blank"),this.getXMLPayloadService()):(console.log("XML Payload Present"),this.continueNPCICommunication())},e=>{console.log("isAppRegisteredForNpci Error => ",e),showToastMessage(this.translatePipe.transform("error in registration"),"error")})}showNpciPageNative(e,t,i,s,n,a,o,c,r,l,p,h,d,_,u,y,g,m,v){console.log("showNpciPageNative called..."),cordova.plugins.npciIosPlugin.showNpciPageNative({credLength:e,otpCredLength:t,atmCredLength:i,txnId:s,tokenValue:n,xmlPayloadValue:a,bankName:o,txnAmount:r,payerAddress:l,payeeDetails:p,payeeName:h,isAtmPINRequired:d,note:c,devId:_,moNo:u,id:y,url:g,entity:m,expiry:v},e=>{console.log("showNpciPageNative success",e),this.finalCredResponseModel={},this.finalCredCallback(e)},e=>{console.log("showNpciPageNativeError => ",e)})}finalCredCallback(e){let t=JSON.parse(e);console.log("finalCredCallback param =>",t),this.finalCredResponseModel.transactionId=t.txnId,t.AtmCredSubType&&t.AtmCredSubType==this.constant.val_npci_ATMPIN&&(this.finalCredResponseModel.credATMDataForJson=t.AtmCredData,this.finalCredResponseModel.credATMkey=t.AtmCredKi,this.finalCredResponseModel.credATMId=t.AtmCredCode,this.finalCredResponseModel.credATMType=t.AtmCredType,this.finalCredResponseModel.credATMSubType=t.AtmCredSubType),t.SubType&&t.SubType==this.constant.val_npci_MPIN&&(this.finalCredResponseModel.credDataForJson=t.CredData,this.finalCredResponseModel.credkey=t.Ki,this.finalCredResponseModel.credId=t.Code,this.finalCredResponseModel.credType=t.Type,this.finalCredResponseModel.credSubType=t.SubType),(t.NewSubType&&t.NewSubType==this.constant.val_npci_SMS||t.NewSubType==this.constant.val_npci_NMPIN)&&(this.finalCredResponseModel.credOTPDataForJson=t.NewCredData,this.finalCredResponseModel.credOTPkey=t.NewCredKi,this.finalCredResponseModel.credOTPId=t.NewCode,this.finalCredResponseModel.credOTPType=t.NewType,this.finalCredResponseModel.credOTPSubType=t.NewSubType),console.log("finalCredResponseModel => ",this.finalCredResponseModel),console.log("NPCI Flow iOS : ",this.npciFlowIdentifier),this.loader.hideLoader(),this.subject.next(this.finalCredResponseModel),this.subject.complete()}continueNPCICommunication(){console.log("continueNPCICommunication called..."),console.log("Account Details => ",this.accountDetails),this.isAtmPINRequired="NO",console.log("this.accountDetails"),console.log(this.accountDetails),this.upiPayModelObj=this.dataService.upiPayModelObj,console.log("this.upiPayModelObj"),console.log(this.upiPayModelObj),console.log("this.upiCreateMandateModel"),console.log(this.upiCreateMandateModel);let e=this.accountDetails.bankName,t=this.accountDetails.credDLength,i=this.accountDetails.atmCredSubType,s=this.accountDetails.atmCredDtype,n=this.accountDetails.atmCredDLength,a=this.accountDetails.otpCredDLength,o="";this.dataService.isEmpty(this.accountDetails.atmCredType)||this.dataService.isEmpty(i)||this.dataService.isEmpty(s)||this.dataService.isEmpty(n)||"ATMPIN"!=i?(o=this.constant.val_npci_credTypeSetUpiPin,this.isAtmPINRequired="NO",this.accountDetails.atmCredType="",i="",s="",n="",this.dataService.isEmpty(this.upiPayModelObj)||(this.upiPayModelObj.atmCredType="",this.upiPayModelObj.atmCredSubType="",this.upiPayModelObj.atmCredDtype="",this.upiPayModelObj.atmCredDlength="")):(this.isAtmPINRequired="YES",o=this.constant.val_npci_credTypeSetUPIPinWithATM),console.log("Open NPCI Page"),console.log("Bank Name = ",e),this.dataService.isEmpty(e)&&(e=""),console.log("npciFlowIdentifier = ",this.npciFlowIdentifier);let c="",r=this.accountDetails.paymentAddress,l="",p=this.dataService.roundOffAmount(this.upiCreateMandateModel.txnAmount);this.npciFlowIdentifier==this.constant.val_npci_flow_setUpiPin_ios?(l="Set UPI PIN",o=this.constant.val_npci_credTypeSetUPIPinWithATM):this.npciFlowIdentifier==this.constant.val_npci_flow_balanceEnquiry_ios||this.npciFlowIdentifier==this.constant.val_npci_flow_mandateBalanceEnquiry_ios?(l="Balance enquiry",o=this.constant.val_npci_credTypeUpiPin,this.isAtmPINRequired="NO"):this.npciFlowIdentifier==this.constant.val_npci_flow_sendMoney_ios?(l="SEND MONEY",o=this.constant.val_npci_credTypeUpiPin,this.selectedFlow===this.constant.val_npci_upiPayVpa?this.upiPayModelObj.payeeVpa=this.upiPayModelObj.payeeAddr:this.selectedFlow===this.constant.val_npci_upiPayMmid?(c=this.upiPayModelObj.payeeMobile+"@"+this.upiPayModelObj.payeeMmid+".mmid.npci",this.upiPayModelObj.payeeVpa=c):this.selectedFlow===this.constant.val_npci_upiPayIfsc?(c=this.upiPayModelObj.payeeAccNo+"@"+this.upiPayModelObj.payeeIfsc+".ifsc.npci",this.upiPayModelObj.payeeVpa=c):this.selectedFlow===this.constant.val_npci_pendingRequest?(this.upiPayModelObj.payeeVpa=this.dataService.pendingWithMe.payeeAddress,this.upiPayModelObj.txnAmount=this.dataService.pendingWithMe.amount):this.selectedFlow===this.constant.val_npci_upiPayVpaBqr||this.selectedFlow===this.constant.val_npci_upiPayIfscBqr||console.log("this.selectedFlow",this.selectedFlow)):this.npciFlowIdentifier==this.constant.val_npci_flow_changeUpiPin_ios?(l="Change UPI PIN",o=this.constant.val_npci_credTypeChangeUpiPin):this.npciFlowIdentifier==this.constant.val_npci_flow_updateMandateEnquiry_ios?(r=this.accountDetails.payerVPA,c=this.accountDetails.payeeVPA):this.npciFlowIdentifier==this.constant.val_npci_flow_revokeMandate_ios?(r=this.selectedMandateDetails.payerVPA,c=this.selectedMandateDetails.payeeVPA,p=this.selectedMandateDetails.txnAmount):console.log("this.npciFlowIdentifier",this.npciFlowIdentifier),console.log("localUPIFlow = ",l),console.log("credTypeValue= ",o),this.npciFlowIdentifier==this.constant.val_npci_flow_sendMoney_ios?(o=this.constant.val_npci_credTypeUpiPin,l="SEND MONEY",this.setDataNpciWithoutCallback(this.upiMobileNumber,this.appId,this.upiDeviceId,"Initial",this.entityId,this.refUrl,this.tokenValue,this.tokenExpiry),this.showNpciPageNative(t,a,n,this.txnId,this.tokenValue,this.xmlPayloadValue,e,l,this.upiPayModelObj.txnAmount,this.upiPayModelObj.payerAddr,this.upiPayModelObj.payeeVpa,this.upiPayModelObj.payeeName,this.isAtmPINRequired,this.upiDeviceId,this.upiMobileNumber,this.appId,this.refUrl,this.entityId,this.tokenExpiry)):this.npciFlowIdentifier==this.constant.val_npci_flow_createMandate_ios||this.npciFlowIdentifier==this.constant.val_npci_flow_updateMandateEnquiry_ios?(o=this.constant.val_npci_credTypeUpiPin,l="CREATE MANDATE",this.setDataNpciWithoutCallback(this.upiMobileNumber,this.appId,this.upiDeviceId,"Initial",this.entityId,this.refUrl,this.tokenValue,this.tokenExpiry),this.showNpciPageNative(t,a,n,this.txnId,this.tokenValue,this.xmlPayloadValue,e,l,p,this.upiCreateMandateModel.payerVPA,this.upiCreateMandateModel.payeeVPA,this.upiCreateMandateModel.payeeName,this.isAtmPINRequired,this.upiDeviceId,this.upiMobileNumber,this.appId,this.refUrl,this.entityId,this.tokenExpiry)):this.npciFlowIdentifier==this.constant.val_npci_flow_revokeMandate_ios?(o=this.constant.val_npci_credTypeUpiPin,l="REVOKE MANDATE",this.setDataNpciWithoutCallback(this.upiMobileNumber,this.appId,this.upiDeviceId,"Initial",this.entityId,this.refUrl,this.tokenValue,this.tokenExpiry),this.showNpciPageNative(t,a,n,this.txnId,this.tokenValue,this.xmlPayloadValue,e,l,p,this.selectedMandateDetails.payerVPA,this.selectedMandateDetails.payeeVPA,this.selectedMandateDetails.payeeName,this.isAtmPINRequired,this.upiDeviceId,this.upiMobileNumber,this.appId,this.refUrl,this.entityId,this.tokenExpiry)):this.npciFlowIdentifier===this.constant.val_npci_flow_acceptMandate_ios?(o=this.constant.val_npci_credTypeUpiPin,console.log("ACCEPT MANDATE Flow"),a="",r=this.upiPayModelObj.payerAddr,c=this.upiPayModelObj.payeeAddr,this.setDataNpciWithoutCallback(this.upiMobileNumber,this.appId,this.upiDeviceId,"Initial",this.entityId,this.refUrl,this.tokenValue,this.tokenExpiry),this.showNpciPageNative(t,a,n,this.txnId,this.tokenValue,this.xmlPayloadValue,e,l,this.upiPayModelObj.txnAmount,r,c,this.upiPayModelObj.payeeName,this.isAtmPINRequired,this.upiDeviceId,this.upiMobileNumber,this.appId,this.refUrl,this.entityId,this.tokenExpiry)):(this.setDataNpciWithoutCallback(this.upiMobileNumber,this.appId,this.upiDeviceId,"Initial",this.entityId,this.refUrl,this.tokenValue,this.tokenExpiry),this.showNpciPageNative(t,a,n,this.txnId,this.tokenValue,this.xmlPayloadValue,e,l,"0.00",r,this.accountDetails.accNum,"",this.isAtmPINRequired,this.upiDeviceId,this.upiMobileNumber,this.appId,this.refUrl,this.entityId,this.tokenExpiry))}getTokenServices(e,t){try{console.log("Inside getToken"),this.dataService.isEmpty(t)&&(t="initial");let i={[this.constant.key_upi_entityID]:this.constant.val_upi_psb,[this.constant.key_npci_mobileNo]:this.upiMobileNumber,[this.constant.key_npci_subAction]:this.constant.upiserviceName_GetToken,[this.constant.key_npci_inputParam]:{[this.constant.key_npci_appVersion]:this.constant.val_upi_app_version,[this.constant.key_upi_credType]:this.constant.val_upi_credTypeChallenge,[this.constant.key_npci_txnNote]:"",[this.constant.key_npci_credSubType]:this.constant.val_upi_initial,[this.constant.key_upi_entityID]:this.constant.val_upi_psb,[this.constant.key_upi_refID]:this.txnId,[this.constant.key_upi_refUrl]:this.constant.val_upi_refUrl,[this.constant.key_npci_keyType]:this.constant.val_upi_GET_TOKEN,[this.constant.key_npci_language]:this.currentLanguage,[this.constant.key_npci_credData]:this.upiDeviceId+"|"+this.constant.val_app_pakage_name+"|"+this.upiMobileNumber+"|"+e,[this.constant.key_npci_device]:this.dataService.getDeviceObjectForUpi(),[this.constant.key_upi_txnID]:this.txnId}},s={[this.constant.key_npci_entityId]:this.constant.getEntityId(this.constant.val_entityId_UMOB),[this.constant.key_npci_cbsType]:this.constant.val_cbsTypeTcs,[this.constant.key_npci_mobPlatform]:this.constant.val_ios,[this.constant.key_npci_mobileAppVersion]:this.constant.val_mobileAppVersion,[this.constant.key_npci_deviceId]:this.deviceId,[this.constant.key_npci_clientAppVersion]:this.constant.val_clientAppVersion,[this.constant.key_npci_upiRequest]:JSON.stringify(i)};console.log("Token Json",i),console.log(s),this.loader.showLoader();let a=this.encryptDecryptService.encryptText(this.encryptKey,JSON.stringify(s));console.log("encryptData => ",JSON.stringify(a)),this.httpService.callBankingAPIService(a,this.localStorageService.getLocalStorage(this.constant.storage_deviceId),this.omniApiName,!0).subscribe(e=>{console.log("Omni Api Success => ",e);let t=e.responseParameter;"00"==t.opstatus?(console.log("Token API Response => "),console.log(t),"00"==t.upiResponse.status&&(t.upiResponse.responseParameter?(this.tokenValue=t.upiResponse.responseParameter.RESULT,this.tokenExpiry=n().add(90,"days").format("DD/MM/YYYY"),this.localStorageService.setSessionStorage("NpciToken",this.tokenValue),this.localStorageService.setLocalStorage("NpciTokenExpiry",this.tokenExpiry),console.log("TOKEN VALUES => "),console.log(this.tokenValue),console.log(this.tokenExpiry),this.getTransactionId().subscribe(e=>{this.txnId=e,console.log("Inside geToken Transaction ID ",e),this.registerIosAppNpci()})):console.log("Token not received..."))):(console.log("Token API Error = ",t),showToastMessage(this.translatePipe.transform("error_something_went_wrong1"),"error"),this.subject.unsubscribe())},e=>{console.log("Omni Api err",e),showToastMessage(this.translatePipe.transform("error_something_went_wrong2"),"error")})}catch(i){this.loader.hideLoader(),showToastMessage(this.translatePipe.transform("error_something_went_wrong3"),"error")}}getXMLPayloadService(){console.log("getXMLPayloadService called...");try{this.loader.showLoader();let e={[this.constant.key_upi_entityID]:this.constant.val_upi_psb,[this.constant.key_npci_mobileNo]:this.upiMobileNumber,[this.constant.key_npci_subAction]:this.constant.upiserviceName_GetListKeysString,[this.constant.key_npci_inputParam]:{[this.constant.key_npci_appVersion]:this.constant.val_upi_app_version,[this.constant.key_npci_language]:this.currentLanguage,[this.constant.key_upi_entityID]:this.constant.val_upi_psb,[this.constant.key_upi_device]:this.dataService.getDeviceObjectForUpi()}},t={[this.constant.key_npci_entityId]:this.constant.getEntityId(this.constant.val_entityId_UMOB),[this.constant.key_npci_cbsType]:this.constant.val_cbsTypeTcs,[this.constant.key_npci_mobPlatform]:this.constant.val_mobPlatform,[this.constant.key_npci_mobileAppVersion]:this.constant.val_mobileAppVersion,[this.constant.key_npci_deviceId]:this.localStorageService.getLocalStorage(this.constant.storage_deviceId),[this.constant.key_npci_clientAppVersion]:this.constant.val_clientAppVersion,[this.constant.key_npci_upiRequest]:JSON.stringify(e)};console.log("omniReqJson => ",JSON.stringify(t));let i=this.encryptDecryptService.encryptText(this.encryptKey,JSON.stringify(t));console.log("encryptData => ",JSON.stringify(i)),this.httpService.callBankingAPIService(i,this.localStorageService.getLocalStorage(this.constant.storage_deviceId),this.omniApiName,!0).subscribe(e=>{console.log("Omni Api Success => ",e);let t=e.responseParameter;"00"==t.opstatus?(console.log("xmlPayloadServiceApiCall Success =>",t),this.xmlPayloadValue=t.upiResponse.responseParameter.RESULT,this.localStorageService.setSessionStorage("NpciXmlPayload",this.xmlPayloadValue),this.continueNPCICommunication()):(console.log("xmlPayloadServiceApiCall Error  = ",t),showToastMessage(this.translatePipe.transform("error_something_went_wrong4"),"error"),this.subject.unsubscribe())},e=>{console.log("Omni Api Error => ",e),showToastMessage(this.translatePipe.transform("error_something_went_wrong5"),"error")})}catch(e){this.loader.hideLoader(),showToastMessage(this.translatePipe.transform("error_something_went_wrong6"),"error")}}}return e.\u0275fac=function(t){return new(t||e)(a.ic(o.a),a.ic(c.a),a.ic(r.a),a.ic(l.a),a.ic(p.a),a.ic(h.a),a.ic(d.a),a.ic(_.a))},e.\u0275prov=a.Ub({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);