(window.webpackJsonp=window.webpackJsonp||[]).push([[340],{qD8S:function(e,t,a){"use strict";a.r(t),a.d(t,"ScanQrModule",(function(){return b}));var c=a("ofXK"),o=a("tyNb"),s=a("fXoL"),i=a("EnSQ"),r=a("oBZJ"),n=a("au7T"),d=a("4Efi"),l=a("paUM"),p=a("H9Rt"),u=a("L7Xq"),h=a("5IsW"),g=a("Eioz");const v=[{path:"",component:(()=>{class e{constructor(e,t,a,c,o,s,i,r,n,d,l){this.DataService=e,this.pluginService=t,this.commonMethod=a,this.router=c,this.location=o,this.scanQrService=s,this.scanQrRequestService=i,this.localStorage=r,this.http=n,this.constant=d,this.translate=l,this.qrModel={},this.popupData={},this.BharatQRAryList=[],this.qrImage="",this.croppedImageBase64="",this.information="",this.headerdata={headerType:"CloseNewHeader",titleName:"Scan & Pay",footertype:"none"}}ngOnInit(){this.DataService.changeMessage(this.headerdata),this.defaultVPAAccountDetails=this.getDefaultVpaAccountDetails(),history.pushState({},"upiDashboard",this.location.prepareExternalUrl("upiDashboard")),history.pushState({},"self",this.location.prepareExternalUrl(this.router.url)),this.scanQRCode()}getDefaultVpaAccountDetails(){let e=this.DataService.vpaAddressList.find(e=>"Y"==e.default);if(e)return{vpaDetails:e,accountDetails:this.getDefaultAccountNoByVpa(e.accounts)};if(this.DataService.vpaAddressList.length>0){let e=this.DataService.vpaAddressList;e.map((e,t)=>{e.default=0==t?"Y":"N"});let t=e.find(e=>"Y"==e.default);if(t)return{vpaDetails:t,accountDetails:this.getDefaultAccountNoByVpa(t.accounts)}}else this.showPopup("noAccountAvailable","")}getDefaultAccountNoByVpa(e){if(e.length>0)return e.find(e=>"Y"==e.isDefaultAccount)}displayContents(e,t){}scanQRCode(){var e=this;this.DataService.platform.toLowerCase()==this.constant.val_android?cordova.plugins.diagnostic.requestCameraAuthorization(t=>{switch(t){case cordova.plugins.diagnostic.permissionStatus.GRANTED:cordova.plugins.QRCodeScannerPlugin.scan({invalidQRMsg:this.translate.transform(this.constant.QRCodeErrorDesc),pointQRMsg:this.translate.transform(this.constant.QRCodeDesc),scanGalleryMsg:this.translate.transform(this.constant.ScanGalleryDesc),recentPayees:""},t=>{console.log("QRDetals Success => ",t),this.scanQrText=JSON.parse(t.text);let a=e.scanQrService.getQrResponse(this.scanQrText.response);a?(e.DataService.ScanQrCodeData=a,console.log("DataService.ScanQrCodeData",e.DataService.ScanQrCodeData),e.DataService.ScanQrCodeData.sign?a.qrPaymentAddress||a.pa?this.routeTo("/scanQRPayment"):e.showPopup("inValidQrCode",""):e.showPopup("insecure-qrcode","")):e.showPopup("inValidQrCode","")},e=>{console.log("QRDetals Error => ",e)});break;case cordova.plugins.diagnostic.permissionStatus.DENIED_ALWAYS:return void cordova.plugins.diagnostic.switchToSettings((function(){console.log("Successfully switched to Settings app")}),(function(e){console.error("The following error occurred: "+e)}))}},(function(e){console.error(e)})):this.DataService.platform.toLowerCase()==this.constant.val_ios?window.plugins.qrscan.startCamera(t=>{if(console.log("qrscan success",t),console.log("Other data => ",JSON.stringify({invalidQRMsg:this.translate.transform(this.constant.QRCodeErrorDesc),pointQRMsg:this.translate.transform(this.constant.QRCodeDesc),scanGalleryMsg:this.translate.transform(this.constant.ScanGalleryDesc),recentPayees:""})),"Cancelled"!=t&&t)if("DENIED"==t||"Not Authorized"==t)this.DataService.cameraPermissionGrantedIos=!1,this.commonMethod.openPopup("div.popup-bottom.enable-camera-permission");else{this.scanQrText=t;let a=e.scanQrService.getQrResponse(this.scanQrText);a?(e.DataService.ScanQrCodeData=a,console.log("DataService.ScanQrCodeData",e.DataService.ScanQrCodeData),e.DataService.ScanQrCodeData.sign?a.qrPaymentAddress||a.pa?this.routeTo("/scanQRPayment"):e.showPopup("inValidQrCode",""):e.showPopup("insecure-qrcode","")):e.showPopup("inValidQrCode","")}},e=>{console.log("qrscan error ",e)}):console.log("unknown platform")}scanQR(){var e=this;this.pluginService.qrCodeScan().subscribe(t=>{console.log(t),this.scanQrText=t.text;let a=e.scanQrService.getQrResponse(t.text);a?(e.DataService.ScanQrCodeData=a,console.log("DataService.ScanQrCodeData",e.DataService.ScanQrCodeData),e.DataService.ScanQrCodeData.sign?a.qrPaymentAddress||a.pa?this.routeTo("/scanQRPayment"):e.showPopup("inValidQrCode",""):e.showPopup("insecure-qrcode","")):e.showPopup("inValidQrCode","")})}qrFrmGallery(){var e=this;this.DataService.platform.toLowerCase()==this.constant.val_android?cordova.plugins.diagnostic.requestExternalStorageAuthorization((function(t){switch(t){case cordova.plugins.diagnostic.permissionStatus.GRANTED:e.pluginService.checkImagePickerReadPermission().subscribe(t=>{t&&e.pluginService.pickImage().subscribe(t=>{e.pluginService.cropImage(t).then(t=>{t&&e.commonMethod.getQRDataFrmGalryImg(t).then(t=>{let a=e.scanQrService.getQrResponse(t);a?(e.DataService.ScanQrCodeData=a,console.log("DataService.ScanQrCodeData",e.DataService.ScanQrCodeData),e.DataService.ScanQrCodeData.sign?a.qrPaymentAddress||a.pa?this.routeTo("/scanQRPayment"):e.showPopup("inValidQrCode",""):e.showPopup("insecure-qrcode","")):e.showPopup("inValidQrCode","")})})})});break;case cordova.plugins.diagnostic.permissionStatus.DENIED_ALWAYS:e.information="ENABLE_STORAGE_PERMISSION_MSG",setTimeout(()=>{e.commonMethod.openPopup("div.popup-bottom.header-info")},100)}}),(function(e){console.error(e)})):e.pluginService.openCameraGallery().then(t=>{e.pluginService.cropImage(t).then(t=>{t&&e.commonMethod.getQRDataFrmGalryImg(t).then(t=>{let a=e.scanQrService.getQrResponse(t);a?(e.DataService.ScanQrCodeData=a,console.log("DataService.ScanQrCodeData",e.DataService.ScanQrCodeData),e.DataService.ScanQrCodeData.sign?a.qrPaymentAddress||a.pa?this.routeTo("/scanQRPayment"):e.showPopup("inValidQrCode",""):e.showPopup("insecure-qrcode","")):e.showPopup("inValidQrCode","")})},e=>{console.log(e)})},e=>{console.log(e)})}validateVpa(){this.pluginService.getTransactionId().subscribe(e=>{var t=this.scanQrRequestService.setValidateVpaRequest(this.DataService.ScanQrCodeData,this.defaultVPAAccountDetails,e);this.UpiApiCall(t)})}validateQrSign(){var e=this.scanQrRequestService.setValidateQrSignRequest(this.scanQrText);this.UpiApiCall(e)}UpiApiCall(e){this.http.callBankingAPIService(e,this.localStorage.getLocalStorage(this.constant.storage_deviceId),this.constant.upiserviceName_PROCESSUPISERVICESESSION,!0).subscribe(e=>{console.log(e);let t=e.responseParameter.upiResponse;if("00"==t.status)switch(t.subActionId){case this.constant.upiserviceName_VALIDATEADDRESS:this.DataService.verifyAddressResp=t.responseParameter,this.DataService.selectedFlow=this.constant.val_npci_scanQrPay,this.routeTo("/scanQRPayment");break;case this.constant.upiserviceName_VALIDATEQRSIGNATURE:this.DataService.selectedFlow=this.constant.val_npci_scanQrPay,this.routeTo("/scanQRPayment")}},e=>{console.log("ERROR!",e)})}showPopup(e,t){this.commonMethod.openPopup("div.popup-bottom."+e),this.popupData=t||{},console.log("this.popupData",this.popupData)}closePopup(e){this.commonMethod.closePopup("div.popup-bottom."+e)}routeTo(e){console.log("location",e),this.DataService.routeWithNgZone(e)}}return e.\u0275fac=function(t){return new(t||e)(s.Yb(i.a),s.Yb(r.a),s.Yb(n.a),s.Yb(o.c),s.Yb(c.n),s.Yb(d.a),s.Yb(l.a),s.Yb(p.a),s.Yb(u.a),s.Yb(h.a),s.Yb(g.a))},e.\u0275cmp=s.Sb({type:e,selectors:[["app-scan-qr"]],decls:97,vars:24,consts:[[1,"main"],[1,"right-main-column","minus-rt-col","mar-custom"],[1,"right-col-container"],[1,"body-page-container"],[1,"container-fluid"],[1,"row"],[1,"white-subheader"],[1,"in-header"],[1,"header-icons-lft"],[1,"header-actions"],[1,"brand-logo","m-auto","text-center"],["src","assets/images/logo/psb-logo.png","alt","psb-logo",1,"logo1"],["src","assets/images/logo/bharatqr.png","alt","bharatqr",1,"logo2"],[1,"header-icons-rit"],[1,"widget-box6"],[1,"component-title6"],[1,"row1"],[1,"col-8","col-md-9"],[1,"col-4","col-md-3"],[1,"component-box"],[1,"col-12"],[1,"ux-small-scroll3"],["href","javascript:;"],[1,"green1"],["src","assets/images/icons/user2.png","alt","user-img"],["src","assets/images/icons/user3.png","alt","user-img"],["src","assets/images/icons/user6.png","alt","user-img"],["src","assets/images/icons/user4.png","alt","user-img"],[1,"footer-container","sticky-actions"],[1,"footer-inactions","minus-rt-col"],[1,"col-12","col-md-12","col-lg-12","text-center"],[1,"powered-logo","mt-0"],["src","assets/images/logo/powered-upi-logo.svg","alt","powered-upi-logo"],[1,"popup-bottom","UPI-global","inValidQrCode"],[1,"text-center"],[1,"row1","mt-2"],[1,"col-12","text-center"],[1,"ux-button","primary","md",3,"click"],[1,"popup-bottom","UPI-global","insecure-qrcode"],[1,"col-6","text-center"],[1,"ux-button","secondary","close-btn","md",3,"click"]],template:function(e,t){1&e&&(s.ec(0,"div",0),s.ec(1,"div",1),s.ec(2,"div",2),s.ec(3,"div",3),s.ec(4,"div",4),s.ec(5,"div",5),s.ec(6,"div",6),s.ec(7,"div",7),s.ec(8,"div",8),s.Zb(9,"div",9),s.dc(),s.ec(10,"div",10),s.Zb(11,"img",11),s.Zb(12,"img",12),s.dc(),s.ec(13,"div",13),s.Zb(14,"div",9),s.dc(),s.dc(),s.dc(),s.dc(),s.ec(15,"div",5),s.ec(16,"div",14),s.ec(17,"div",15),s.ec(18,"div",16),s.ec(19,"div",17),s.ec(20,"h3"),s.Sc(21),s.qc(22,"translate"),s.dc(),s.dc(),s.Zb(23,"div",18),s.dc(),s.dc(),s.ec(24,"div",19),s.ec(25,"div",16),s.ec(26,"div",20),s.ec(27,"div",21),s.ec(28,"a",22),s.ec(29,"span",23),s.ec(30,"h6"),s.Sc(31,"RS"),s.dc(),s.dc(),s.ec(32,"em"),s.Sc(33,"Rohan Singh"),s.dc(),s.dc(),s.ec(34,"a",22),s.ec(35,"span",23),s.Zb(36,"img",24),s.dc(),s.ec(37,"em"),s.Sc(38,"Aarti"),s.dc(),s.dc(),s.ec(39,"a",22),s.ec(40,"span",23),s.Zb(41,"img",25),s.dc(),s.ec(42,"em"),s.Sc(43,"Sohan"),s.dc(),s.dc(),s.ec(44,"a",22),s.ec(45,"span",23),s.Zb(46,"img",26),s.dc(),s.ec(47,"em"),s.Sc(48,"Jyoti"),s.dc(),s.dc(),s.ec(49,"a",22),s.ec(50,"span",23),s.Zb(51,"img",27),s.dc(),s.ec(52,"em"),s.Sc(53,"Nivedita "),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.ec(54,"div",28),s.ec(55,"div",29),s.ec(56,"div",4),s.ec(57,"div",5),s.ec(58,"div",30),s.ec(59,"div",31),s.Zb(60,"img",32),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.dc(),s.ec(61,"div",33),s.ec(62,"div",5),s.ec(63,"div",20),s.ec(64,"h4",34),s.Sc(65),s.qc(66,"translate"),s.dc(),s.dc(),s.dc(),s.ec(67,"div",5),s.ec(68,"div",20),s.ec(69,"p"),s.Sc(70),s.qc(71,"translate"),s.dc(),s.dc(),s.dc(),s.ec(72,"div",35),s.ec(73,"div",36),s.ec(74,"button",37),s.lc("click",(function(){return t.closePopup("inValidQrCode")})),s.Sc(75),s.qc(76,"translate"),s.dc(),s.dc(),s.dc(),s.dc(),s.ec(77,"div",38),s.ec(78,"div",5),s.ec(79,"div",20),s.ec(80,"h4",34),s.Sc(81),s.qc(82,"translate"),s.dc(),s.dc(),s.dc(),s.ec(83,"div",5),s.ec(84,"div",20),s.ec(85,"p"),s.Sc(86),s.qc(87,"translate"),s.dc(),s.dc(),s.dc(),s.ec(88,"div",35),s.ec(89,"div",39),s.ec(90,"button",40),s.lc("click",(function(){return t.validateVpa(),t.closePopup("insecure-qrcode")})),s.Sc(91),s.qc(92,"translate"),s.dc(),s.dc(),s.ec(93,"div",39),s.ec(94,"button",40),s.lc("click",(function(){return t.closePopup("insecure-qrcode")})),s.Sc(95),s.qc(96,"translate"),s.dc(),s.dc(),s.dc(),s.dc()),2&e&&(s.Mb(21),s.Tc(s.rc(22,8,"RECENT")),s.Mb(44),s.Tc(s.rc(66,10,"INVALID_QR_CODE")),s.Mb(5),s.Uc(" ",s.rc(71,12,"SCAN_VALID_QR_CODE")," "),s.Mb(5),s.Tc(s.rc(76,14,"OK")),s.Mb(6),s.Tc(s.rc(82,16,"INSECURE_QR_CODE")),s.Mb(5),s.Uc(" ",s.rc(87,18,"INSECURE_QR_CODE_DO_YOU_WANT_TO_PROCEED")," "),s.Mb(5),s.Tc(s.rc(92,20,"YES")),s.Mb(4),s.Tc(s.rc(96,22,"NO")))},pipes:[g.a],styles:[""]}),e})()}];let S=(()=>{class e{}return e.\u0275mod=s.Wb({type:e}),e.\u0275inj=s.Vb({factory:function(t){return new(t||e)},imports:[[o.g.forChild(v)],o.g]}),e})();var m=a("AvjH"),D=a("PCNd"),Q=a("3Pt+");let b=(()=>{class e{}return e.\u0275mod=s.Wb({type:e}),e.\u0275inj=s.Vb({factory:function(t){return new(t||e)},imports:[[c.c,S,Q.m,Q.C,D.a,m.a]]}),e})()}}]);